# Script for Iterative Building of the Shiny App
# Erich 05.01.2022

# Packages -------
library(shiny)
library(tidyverse)
library(tidyselect)
library(markdown)

# Cast Members
castaways <- c("Jenny","Lindsay", "Drea","Johnathan", "Chanelle",
               "Hai","Maryanne","Mike","Omar","Swati","Tori", "Daniel",
               "Rocksroy", "Romeo","Lydia","Marya S")

# Our Selections
picks <- read_csv("picks.csv") %>%
  mutate(fullteam  = as.vector(paste(MVP, Pick2, Pick3, Pick4, Pick5, sep=",")))

# Merge Cutoff
mergeweek <- 6
currentweek <- 7

# The Tribe Spoke: Table of eliminated choices
eliminated <- tribble(~cast, ~week,
                         "Marya S", 1,
                         "Jenny", 2,
                         "Swati", 3,
                         "Daniel", 4,
                         "Lydia", 5, 
                         "Chanelle", 6, # Jury Begins
                         "Rocksroy", 7,
                         "Tori", 7) 

# Create Main Scoring Table ----
picks2 <- picks %>%
  mutate(tot_remain = 5 - str_count(fullteam, 
                                pattern = paste(eliminated$cast,collapse = "|")))

# Scoring
weekly_score <- function(x,y) {
  # Only the previously eliminated weeks considered
  nowelim <- eliminated %>%
    filter(week <= y)
  
  x %>% 
    mutate(weekremain = 5 - str_count(fullteam, 
                                   pattern = paste(nowelim$cast, collapse = "|"))) %>%
    mutate(weekscore = if_else(y <= mergeweek, weekremain, weekremain*3))
  
}



picks3 <- weekly_score(picks2, currentweek)

# Fun Plots ----

# Most popular picks

# 